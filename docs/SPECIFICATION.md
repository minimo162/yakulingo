# YakuLingo - æŠ€è¡“ä»•æ§˜æ›¸

> **Version**: 2.14
> **Date**: 2025-12
> **App Name**: YakuLingo (è¨³ãƒªãƒ³ã‚´)

---

## ç›®æ¬¡

1. [æ¦‚è¦](#1-æ¦‚è¦)
2. [ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#2-ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
3. [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ](#3-ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ )
4. [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](#4-ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«)
5. [UIä»•æ§˜](#5-uiä»•æ§˜)
6. [ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼](#6-ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼)
7. [ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ­ã‚»ãƒƒã‚µ](#7-ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ­ã‚»ãƒƒã‚µ)
8. [ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†](#8-ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†)
9. [ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ](#9-ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ)
10. [ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸](#10-ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸)
11. [è‡ªå‹•æ›´æ–°](#11-è‡ªå‹•æ›´æ–°)
12. [è¨­å®šãƒ»é…å¸ƒ](#12-è¨­å®šé…å¸ƒ)
13. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#13-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)

---

## 1. æ¦‚è¦

### 1.1 ã‚·ã‚¹ãƒ†ãƒ ç›®çš„

YakuLingoã¯ã€æ—¥æœ¬èªã¨è‹±èªã®åŒæ–¹å‘ç¿»è¨³ã‚’æä¾›ã™ã‚‹ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
M365 Copilotã‚’ç¿»è¨³ã‚¨ãƒ³ã‚¸ãƒ³ã¨ã—ã¦ä½¿ç”¨ã—ã€ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç¿»è¨³ã‚’ã‚µãƒãƒ¼ãƒˆã€‚

### 1.2 ä¸»è¦æ©Ÿèƒ½

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| **Text Translation** | ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦å³åº§ã«ç¿»è¨³ï¼ˆè¨€èªè‡ªå‹•æ¤œå‡ºï¼‰ |
| **File Translation** | Excel/Word/PowerPoint/PDF ã®ä¸€æ‹¬ç¿»è¨³ |
| **Layout Preservation** | ç¿»è¨³å¾Œã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½“è£ã‚’ç¶­æŒ |
| **Bilingual Output** | åŸæ–‡ã¨è¨³æ–‡ã‚’ä¸¦ã¹ãŸå¯¾è¨³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•ç”Ÿæˆ |
| **Glossary Export** | ç¿»è¨³ãƒšã‚¢ã‚’CSVã§å‡ºåŠ›ï¼ˆç”¨èªç®¡ç†ã«æ´»ç”¨ï¼‰ |
| **Reference Files** | ç”¨èªé›†ãƒ»ã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰ãƒ»å‚è€ƒè³‡æ–™ã«ã‚ˆã‚‹ä¸€è²«ã—ãŸç¿»è¨³ |
| **Translation History** | éå»ã®ç¿»è¨³ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ãƒ»æ¤œç´¢ |
| **Auto Update** | GitHub ReleasesçµŒç”±ã§è‡ªå‹•æ›´æ–° |

### 1.3 è¨€èªè‡ªå‹•æ¤œå‡º

å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã®è¨€èªã‚’M365 Copilotã§è‡ªå‹•æ¤œå‡ºã—ã€é©åˆ‡ãªæ–¹å‘ã«ç¿»è¨³ï¼š

| å…¥åŠ›è¨€èª | å‡ºåŠ› |
|---------|------|
| æ—¥æœ¬èª | è‹±èªï¼ˆã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šå¯ã€ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³èª¿æ•´å¯ï¼‰ |
| ãã®ä»– | æ—¥æœ¬èªï¼ˆè§£èª¬ä»˜ãã€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ä»˜ãï¼‰ |

**æ¤œå‡ºãƒ¡ã‚«ãƒ‹ã‚ºãƒ :**
- `detect_language()`: Copilotã«`detect_language.txt`ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é€ä¿¡ã—ã€è¨€èªåã‚’å–å¾—
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ãƒ­ãƒ¼ã‚«ãƒ«ã®`is_japanese_text()`é–¢æ•°ï¼ˆUnicodeæ–‡å­—ç¯„å›²åˆ†æï¼‰

### 1.4 å¯¾å¿œãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

| å½¢å¼ | æ‹¡å¼µå­ | ãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
|------|--------|----------|
| Excel | `.xlsx` `.xls` | xlwings (Win/Mac) / openpyxl (fallback) |
| Word | `.docx` `.doc` | python-docx |
| PowerPoint | `.pptx` `.ppt` | python-pptx |
| PDF | `.pdf` | PyMuPDF, pdfminer.six, PP-DocLayout-L (PaddleOCR) |

### 1.5 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| Layer | Technology |
|-------|------------|
| UI | NiceGUI + pywebview (Material Design 3) |
| Backend | FastAPI (via NiceGUI) |
| Translation | M365 Copilot (Playwright + Edge) |
| File Processing | openpyxl, python-docx, python-pptx, PyMuPDF |
| Storage | SQLite (translation history) |
| Auto Update | GitHub Releases API |

---

## 2. ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 2.1 å…¨ä½“æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            YakuLingo                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        Presentation Layer                         â”‚  â”‚
â”‚  â”‚                     (NiceGUI + pywebview)                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Text Tab   â”‚  â”‚  File Tab   â”‚  â”‚  Update Notification    â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                    â”‚                                    â”‚
â”‚                                    â–¼                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                         Service Layer                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚TranslationServiceâ”‚  â”‚ BatchTranslator  â”‚  â”‚  AutoUpdater   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚+ translate_text()â”‚  â”‚+ translate_blocksâ”‚  â”‚+ check_update()â”‚  â”‚  â”‚
â”‚  â”‚  â”‚+ translate_file()â”‚  â”‚                  â”‚  â”‚+ download()    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                         â”‚                         â”‚          â”‚
â”‚          â–¼                         â–¼                         â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ CopilotHandlerâ”‚     â”‚   File Processors   â”‚     â”‚   HistoryDB   â”‚    â”‚
â”‚  â”‚ (Edge+        â”‚     â”‚ Excel/Word/PPT/PDF  â”‚     â”‚   (SQLite)    â”‚    â”‚
â”‚  â”‚  Playwright)  â”‚     â”‚                     â”‚     â”‚               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ãƒ¬ã‚¤ãƒ¤ãƒ¼è²¬å‹™

| Layer | Responsibility |
|-------|----------------|
| **Presentation** | NiceGUI + pywebviewã«ã‚ˆã‚‹UIã€çŠ¶æ…‹è¡¨ç¤º |
| **Service** | ç¿»è¨³å‡¦ç†ã®èª¿æ•´ã€ãƒãƒƒãƒå‡¦ç†ã€è‡ªå‹•æ›´æ–° |
| **CopilotHandler** | Edgeèµ·å‹•ã€Playwrightæ¥ç¶šã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ |
| **File Processors** | ãƒ•ã‚¡ã‚¤ãƒ«è§£æã€ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã€ç¿»è¨³é©ç”¨ |
| **Storage** | ç¿»è¨³å±¥æ­´ã®æ°¸ç¶šåŒ–ï¼ˆSQLiteï¼‰ |
| **Config** | è¨­å®šèª­ã¿è¾¼ã¿/ä¿å­˜ã€å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç† |

---

## 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
YakuLingo/
â”œâ”€â”€ app.py                          # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ pyproject.toml
â”œâ”€â”€ uv.lock                         # ä¾å­˜é–¢ä¿‚ãƒ­ãƒƒã‚¯ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ requirements.txt
â”‚
â”œâ”€â”€ yakulingo/                      # ãƒ¡ã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ ui/                         # Presentation Layer
â”‚   â”‚   â”œâ”€â”€ app.py                  # YakuLingoApp ã‚¯ãƒ©ã‚¹
â”‚   â”‚   â”œâ”€â”€ state.py                # AppState
â”‚   â”‚   â”œâ”€â”€ styles.py               # M3 ãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ & CSS
â”‚   â”‚   â”œâ”€â”€ utils.py                # UI utilities (temp files, dialogs, text formatting)
â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚       â”œâ”€â”€ text_panel.py       # ãƒ†ã‚­ã‚¹ãƒˆç¿»è¨³ãƒ‘ãƒãƒ«
â”‚   â”‚       â”œâ”€â”€ file_panel.py       # ãƒ•ã‚¡ã‚¤ãƒ«ç¿»è¨³ãƒ‘ãƒãƒ«
â”‚   â”‚       â””â”€â”€ update_notification.py  # æ›´æ–°é€šçŸ¥UI
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                   # Service Layer
â”‚   â”‚   â”œâ”€â”€ translation_service.py  # TranslationService
â”‚   â”‚   â”œâ”€â”€ copilot_handler.py      # CopilotHandler
â”‚   â”‚   â”œâ”€â”€ prompt_builder.py       # PromptBuilder
â”‚   â”‚   â””â”€â”€ updater.py              # è‡ªå‹•æ›´æ–°ã‚µãƒ¼ãƒ“ã‚¹
â”‚   â”‚
â”‚   â”œâ”€â”€ processors/                 # File Processors
â”‚   â”‚   â”œâ”€â”€ base.py                 # FileProcessor (ABC)
â”‚   â”‚   â”œâ”€â”€ translators.py          # CellTranslator, ParagraphTranslator
â”‚   â”‚   â”œâ”€â”€ font_manager.py         # FontManager, FontTypeDetector
â”‚   â”‚   â”œâ”€â”€ excel_processor.py
â”‚   â”‚   â”œâ”€â”€ word_processor.py
â”‚   â”‚   â”œâ”€â”€ pptx_processor.py
â”‚   â”‚   â””â”€â”€ pdf_processor.py
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/                    # Storage Layer
â”‚   â”‚   â””â”€â”€ history_db.py           # HistoryDB (SQLite)
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ types.py                # å‹å®šç¾©
â”‚   â”‚
â”‚   â””â”€â”€ config/
â”‚       â””â”€â”€ settings.py             # AppSettings
â”‚
â”œâ”€â”€ tests/                          # ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆï¼ˆ26ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ conftest.py
â”‚   â””â”€â”€ test_*.py
â”‚
â”œâ”€â”€ prompts/                        # ç¿»è¨³ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆ16ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ detect_language.txt         # è¨€èªæ¤œå‡ºç”¨ï¼ˆCopilotï¼‰
â”‚   â”œâ”€â”€ file_translate_to_en_{standard|concise|minimal}.txt  # ãƒ•ã‚¡ã‚¤ãƒ«ç¿»è¨³ï¼ˆæ—¥â†’è‹±ï¼‰
â”‚   â”œâ”€â”€ file_translate_to_jp.txt    # ãƒ•ã‚¡ã‚¤ãƒ«ç¿»è¨³ç”¨ï¼ˆè‹±â†’æ—¥ï¼‰
â”‚   â”œâ”€â”€ text_translate_to_en_{standard|concise|minimal}.txt  # ãƒ†ã‚­ã‚¹ãƒˆç¿»è¨³ï¼ˆæ—¥â†’è‹±ï¼‰
â”‚   â”œâ”€â”€ text_translate_to_jp.txt    # ãƒ†ã‚­ã‚¹ãƒˆç¿»è¨³ç”¨ï¼ˆè‹±â†’æ—¥ã€è§£èª¬ä»˜ãï¼‰
â”‚   â”œâ”€â”€ adjust_custom.txt           # ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³èª¿æ•´: ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ text_alternatives.txt       # ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—: ä»–ã®è¨€ã„æ–¹
â”‚   â”œâ”€â”€ text_review_en.txt          # ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—: è‹±æ–‡ã‚’ãƒã‚§ãƒƒã‚¯
â”‚   â”œâ”€â”€ text_check_my_english.txt   # ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç·¨é›†è‹±æ–‡ãƒã‚§ãƒƒã‚¯
â”‚   â”œâ”€â”€ text_summarize.txt          # ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—: è¦ç‚¹ã‚’æ•™ãˆã¦
â”‚   â”œâ”€â”€ text_question.txt           # ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—: è³ªå•ã¸ã®å›ç­”
â”‚   â””â”€â”€ text_reply_email.txt        # ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—: è¿”ä¿¡ãƒ¡ãƒ¼ãƒ«ä½œæˆ
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.template.json      # è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚
â”œâ”€â”€ glossary.csv                    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆç”¨èªé›†ï¼‰
â”‚
â”œâ”€â”€ packaging/                      # é…å¸ƒãƒ»ãƒ“ãƒ«ãƒ‰é–¢é€£
â”‚   â”œâ”€â”€ installer/                  # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…±æœ‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©
â”‚   â”œâ”€â”€ launcher/                   # ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ãƒ³ãƒãƒ£ãƒ¼ï¼ˆRustè£½ï¼‰
â”‚   â”‚   â”œâ”€â”€ Cargo.toml              # Rust ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”‚   â”‚   â””â”€â”€ src/main.rs             # ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ install_deps.bat            # ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
â”‚   â””â”€â”€ make_distribution.bat       # é…å¸ƒãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ
â”‚
â””â”€â”€ docs/
    â”œâ”€â”€ DISTRIBUTION.md             # é…å¸ƒã‚¬ã‚¤ãƒ‰
    â””â”€â”€ SPECIFICATION.md            # ã“ã®ä»•æ§˜æ›¸
```

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«

### 4.1 åˆ—æŒ™å‹

```python
class FileType(Enum):
    EXCEL = "excel"
    WORD = "word"
    POWERPOINT = "powerpoint"
    PDF = "pdf"

class TranslationStatus(Enum):
    PENDING = "pending"
    PROCESSING = "processing"
    COMPLETED = "completed"
    FAILED = "failed"
    CANCELLED = "cancelled"

class TranslationPhase(Enum):
    EXTRACTING = "extracting"      # ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºä¸­
    OCR = "ocr"                    # OCRå‡¦ç†ä¸­ï¼ˆPDFï¼‰
    TRANSLATING = "translating"    # ç¿»è¨³ä¸­
    APPLYING = "applying"          # ç¿»è¨³é©ç”¨ä¸­
    COMPLETE = "complete"          # å®Œäº†

# è‡ªå‹•æ›´æ–°ç”¨
class UpdateStatus(Enum):
    UP_TO_DATE = "up_to_date"
    UPDATE_AVAILABLE = "update_available"
    DOWNLOADING = "downloading"
    READY_TO_INSTALL = "ready_to_install"
    ERROR = "error"
```

### 4.2 ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹

```python
@dataclass
class SectionDetail:
    """ã‚»ã‚¯ã‚·ãƒ§ãƒ³è©³ç´°ï¼ˆã‚·ãƒ¼ãƒˆã€ãƒšãƒ¼ã‚¸ã€ã‚¹ãƒ©ã‚¤ãƒ‰ï¼‰- éƒ¨åˆ†ç¿»è¨³å¯¾å¿œ"""
    index: int        # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    name: str         # ã‚»ã‚¯ã‚·ãƒ§ãƒ³å
    selected: bool = True  # ç¿»è¨³å¯¾è±¡ã¨ã—ã¦é¸æŠã•ã‚Œã¦ã„ã‚‹ã‹

@dataclass
class TextBlock:
    id: str           # ä¸€æ„è­˜åˆ¥å­ï¼ˆä¾‹: "Sheet1_A1"ï¼‰
    text: str         # å…ƒãƒ†ã‚­ã‚¹ãƒˆ
    location: str     # ä½ç½®è¡¨ç¤ºï¼ˆä¾‹: "Sheet1, A1"ï¼‰
    metadata: dict    # è¿½åŠ æƒ…å ±ï¼ˆfont_name, font_sizeç­‰ï¼‰

@dataclass
class FileInfo:
    path: Path
    file_type: FileType
    size_bytes: int
    sheet_count: Optional[int]      # Excel
    page_count: Optional[int]       # Word, PDF
    slide_count: Optional[int]      # PowerPoint
    text_block_count: int
    section_details: list[SectionDetail]  # éƒ¨åˆ†ç¿»è¨³ç”¨ã‚»ã‚¯ã‚·ãƒ§ãƒ³æƒ…å ±

    @property
    def selected_block_count(self) -> int:
        """é¸æŠã•ã‚ŒãŸã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯æ•°ã‚’è¨ˆç®—"""

@dataclass
class TranslationProgress:
    current: int
    total: int
    status: str
    phase: TranslationPhase = TranslationPhase.TRANSLATING
    phase_detail: str = ""        # è©³ç´°ï¼ˆä¾‹: "Page 3/10", "Batch 2/5"ï¼‰
    percentage: float = 0.0
    estimated_remaining: Optional[int] = None

@dataclass
class TranslationOption:
    """å˜ä¸€ã®ç¿»è¨³ã‚ªãƒ—ã‚·ãƒ§ãƒ³"""
    text: str                        # ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆ
    explanation: str                 # ä½¿ç”¨æ–‡è„ˆãƒ»èª¬æ˜
    char_count: int = 0

@dataclass
class TextTranslationResult:
    """ãƒ†ã‚­ã‚¹ãƒˆç¿»è¨³çµæœï¼ˆè¤‡æ•°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãï¼‰"""
    source_text: str
    source_char_count: int
    options: list[TranslationOption]
    output_language: str = "en"      # "en" or "jp" - è‡ªå‹•æ¤œå‡ºã•ã‚ŒãŸå‡ºåŠ›è¨€èª
    error_message: Optional[str] = None

@dataclass
class TranslationResult:
    """ãƒ•ã‚¡ã‚¤ãƒ«ç¿»è¨³çµæœ"""
    status: TranslationStatus
    output_path: Optional[Path]           # ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«
    bilingual_path: Optional[Path]        # å¯¾è¨³ãƒ•ã‚¡ã‚¤ãƒ« (åŸæ–‡+è¨³æ–‡)
    glossary_path: Optional[Path]         # ç”¨èªé›†CSV
    blocks_translated: int
    blocks_total: int
    duration_seconds: float
    error_message: Optional[str]
    warnings: list[str]

    @property
    def output_files(self) -> list[tuple[Path, str]]:
        """å…¨å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªã‚¹ãƒˆ [(path, description), ...]"""

@dataclass
class HistoryEntry:
    """ç¿»è¨³å±¥æ­´ã‚¨ãƒ³ãƒˆãƒª"""
    source_text: str
    result: TextTranslationResult
    timestamp: str                   # ISO format

@dataclass
class VersionInfo:
    """ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±ï¼ˆè‡ªå‹•æ›´æ–°ç”¨ï¼‰"""
    version: str
    release_date: str
    download_url: str
    release_notes: str
    file_size: int = 0
    requires_reinstall: bool = False  # [REQUIRES_REINSTALL]ãƒãƒ¼ã‚«ãƒ¼æ¤œå‡ºæ™‚

@dataclass
class BatchTranslationResult:
    """ãƒãƒƒãƒç¿»è¨³çµæœã®è©³ç´°"""
    translations: dict[str, str]           # block_id -> translated_text
    untranslated_block_ids: list[str]      # ç¿»è¨³ã•ã‚Œãªã‹ã£ãŸãƒ–ãƒ­ãƒƒã‚¯
    mismatched_batch_count: int = 0        # ãƒãƒƒãƒçµæœæ•°ã®ä¸ä¸€è‡´å›æ•°

    @property
    def has_issues(self) -> bool:
        """ç¿»è¨³ã«å•é¡ŒãŒã‚ã£ãŸã‹ã©ã†ã‹"""

    @property
    def success_rate(self) -> float:
        """æˆåŠŸç‡ã‚’è¨ˆç®—"""
```

### 4.3 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹

```python
# UIçŠ¶æ…‹åˆ—æŒ™å‹ (yakulingo/ui/state.py)
class Tab(Enum):
    TEXT = "text"
    FILE = "file"

class FileState(Enum):
    EMPTY = "empty"
    SELECTED = "selected"
    TRANSLATING = "translating"
    COMPLETE = "complete"
    ERROR = "error"

class TextViewState(Enum):
    INPUT = "input"    # å¤§ããªå…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆ2ã‚«ãƒ©ãƒ å¹…ï¼‰
    RESULT = "result"  # ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆå…¥åŠ› + çµæœãƒ‘ãƒãƒ«

@dataclass
class AppState:
    # ãƒ†ã‚­ã‚¹ãƒˆã‚¿ãƒ–
    source_text: str = ""
    text_result: Optional[TextTranslationResult] = None
    text_translating: bool = False
    text_view_state: TextViewState = TextViewState.INPUT
    text_translation_elapsed_time: Optional[float] = None

    # ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ãƒ–
    file_state: FileState = FileState.EMPTY
    selected_file: Optional[Path] = None
    file_info: Optional[FileInfo] = None
    file_output_language: str = "en"  # or "jp"
    translation_progress: float = 0.0
    translation_status: str = ""
    output_file: Optional[Path] = None
    error_message: str = ""

    # å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«
    reference_files: List[Path] = field(default_factory=list)

    # Copilotæ¥ç¶š
    copilot_ready: bool = False

    # ç¿»è¨³å±¥æ­´ï¼ˆSQLiteãƒãƒƒã‚¯ï¼‰
    history: list[HistoryEntry] = field(default_factory=list)
    history_drawer_open: bool = False

    # ãƒ¡ã‚½ãƒƒãƒ‰
    def can_translate(self) -> bool: ...
    def is_translating(self) -> bool: ...
    def add_to_history(self, entry: HistoryEntry) -> None: ...
    def delete_history_entry(self, entry_id: int) -> None: ...
    def toggle_section_selection(self, index: int) -> None: ...
```

---

## 5. UIä»•æ§˜

### 5.1 ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦è¨­å®š

| Property | Value |
|----------|-------|
| Mode | Native window (pywebview) |
| Host | 127.0.0.1 |
| Port | 8765 |
| Title | YakuLingo |
| Favicon | ğŸ |
| Theme | Light (M3 Design) |

### 5.2 å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ YakuLingo                              [Update Available]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ Text ]  [ File ]                                   TAB BAR    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                        CONTENT AREA                             â”‚
â”‚                      (Tab-specific UI)                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã«å³åº§ã«ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’è¡¨ç¤ºã—ã€UIã®æº–å‚™å®Œäº†ã‚’å¾…æ©Ÿã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚                                                                 â”‚
â”‚                          â‹¯ (spinner)                            â”‚
â”‚                          YakuLingo                              â”‚
â”‚                                                                 â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

NiceGUIã®`await client.connected()`ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šå¾Œã«ãƒ¡ã‚¤ãƒ³UIã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã€‚

### 5.4 Text Tab

**çµ±ä¸€UIæ§‹é€ ï¼ˆè‹±è¨³ãƒ»å’Œè¨³å…±é€šï¼‰:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ åŸæ–‡                                                   [ğŸ“‹]â”‚â”‚
â”‚  â”‚ "å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ..."                                           â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  â‹¯ ğŸ‡¯ğŸ‡µ æ—¥æœ¬èªã‹ã‚‰ğŸ‡ºğŸ‡¸ è‹±èªã¸ç¿»è¨³ä¸­...    â† ç¿»è¨³çŠ¶æ…‹ï¼ˆç¿»è¨³ä¸­ï¼‰   â”‚
â”‚  âœ“ ğŸ‡¯ğŸ‡µ æ—¥æœ¬èªã‹ã‚‰ğŸ‡ºğŸ‡¸ è‹±èªã¸ç¿»è¨³ã—ã¾ã—ãŸ [3.2ç§’] â† ç¿»è¨³çŠ¶æ…‹ï¼ˆå®Œäº†ï¼‰â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ "Translation text / æ—¥æœ¬èªè¨³..."               [ğŸ“‹] [æˆ»ã—è¨³]â”‚â”‚
â”‚  â”‚ Explanation / è§£èª¬...                                       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                 â”‚
â”‚  ğŸ’¡ [ğŸ”„ å†ç¿»è¨³]                         â† å¹ãå‡ºã—é¢¨ãƒ’ãƒ³ãƒˆ      â”‚
â”‚                                                                 â”‚
â”‚  [ã‚ªãƒ—ã‚·ãƒ§ãƒ³1]                          â† å˜ç‹¬ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«â”‚
â”‚  [ã‚ªãƒ—ã‚·ãƒ§ãƒ³2]                                                  â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” [â†‘]  â”‚
â”‚  â”‚ ä¾‹: ...                     ï¼ˆç¸¦å¹…ã„ã£ã±ã„ã«æ‹¡å¼µï¼‰     â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŸæ–‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³:**
- ç¿»è¨³çµæœãƒ‘ãƒãƒ«ä¸Šéƒ¨ã«åŸæ–‡ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤º
- ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã§åŸæ–‡ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼

**ç¿»è¨³çŠ¶æ…‹è¡¨ç¤º:**
- ç¿»è¨³ä¸­: ã€Œâ‹¯ ğŸ‡¯ğŸ‡µ æ—¥æœ¬èªã‹ã‚‰ğŸ‡ºğŸ‡¸ è‹±èªã¸ç¿»è¨³ä¸­...ã€ï¼ˆã‚¹ãƒ”ãƒŠãƒ¼ä»˜ãï¼‰
- å®Œäº†å¾Œ: ã€Œâœ“ ç¿»è¨³ã—ã¾ã—ãŸã€+ çµŒéæ™‚é–“ãƒãƒƒã‚¸
- è¨€èªåˆ¤å®šä¸­: ã€ŒğŸ” è¨€èªã‚’åˆ¤å®šã—ã¦ã„ã¾ã™...ã€

**æ—¥æœ¬èªå…¥åŠ›æ™‚ï¼ˆè‹±è¨³ï¼‰:**
- çµæœã‚«ãƒ¼ãƒ‰: ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆ + èª¬æ˜
- ğŸ’¡ [å†ç¿»è¨³]: å¹ãå‡ºã—é¢¨ãƒ’ãƒ³ãƒˆè¡Œ
- èª¿æ•´ã‚ªãƒ—ã‚·ãƒ§ãƒ³: [ã‚‚ã†å°‘ã—çŸ­ãâ”‚ã‚ˆã‚Šè©³ã—ã], [ä»–ã®è¨€ã„æ–¹ã¯ï¼Ÿ]
- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å…¥åŠ›: "ä¾‹: ã‚‚ã£ã¨ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã«"ï¼ˆç¸¦å¹…ã„ã£ã±ã„ï¼‰

**ãã®ä»–å…¥åŠ›æ™‚ï¼ˆå’Œè¨³ï¼‰:**
- çµæœã‚«ãƒ¼ãƒ‰: è¨³æ–‡ + è§£èª¬
- ğŸ’¡ [å†ç¿»è¨³]: å¹ãå‡ºã—é¢¨ãƒ’ãƒ³ãƒˆè¡Œ
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³: [è‹±æ–‡ã‚’ãƒã‚§ãƒƒã‚¯], [è¦ç‚¹ã‚’æ•™ãˆã¦]
- ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å…¥åŠ›: "ä¾‹: è¿”ä¿¡ã®ä¸‹æ›¸ãã‚’æ›¸ã„ã¦"ï¼ˆç¸¦å¹…ã„ã£ã±ã„ï¼‰

**ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ä»•æ§˜:**

| Property | Value |
|----------|-------|
| Min height | 160px |
| Font | System default |
| Auto-grow | Yes |
| Padding | 16px |

**ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³èª¿æ•´ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆè‹±è¨³ï¼‰:**
| ã‚¿ã‚¤ãƒ— | ã‚ªãƒ—ã‚·ãƒ§ãƒ³ |
|--------|----------|
| ãƒšã‚¢ | [ã‚‚ã†å°‘ã—çŸ­ã] â†” [ã‚ˆã‚Šè©³ã—ã] |
| å˜ç‹¬ | [ä»–ã®è¨€ã„æ–¹ã¯ï¼Ÿ] |

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆå’Œè¨³ï¼‰:**
| ãƒœã‚¿ãƒ³ | æ©Ÿèƒ½ |
|--------|------|
| è‹±æ–‡ã‚’ãƒã‚§ãƒƒã‚¯ | åŸæ–‡ã®è‹±èªã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| è¦ç‚¹ã‚’æ•™ãˆã¦ | è¦ç‚¹ã‚’ç®‡æ¡æ›¸ãã§æŠ½å‡º |

### 5.5 File Tab

**State: Empty**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”  â”‚
â”‚  â”‚                          ğŸ“„                               â”‚  â”‚
â”‚  â”‚                 Drop file to translate                    â”‚  â”‚
â”‚  â”‚                   or click to browse                      â”‚  â”‚
â”‚  â”‚            .xlsx   .docx   .pptx   .pdf                   â”‚  â”‚
â”‚  â””â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**State: Translating**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚  ğŸ“Š report_2024.xlsx                                      â”‚  â”‚
â”‚  â”‚  Translating...                                     75%   â”‚  â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘        â”‚  â”‚
â”‚                         [ Cancel ]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**State: Complete**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¿»è¨³å®Œäº†ãƒ€ã‚¤ã‚¢ãƒ­ã‚° (Completion Dialog)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  âœ“ ç¿»è¨³ãŒå®Œäº†ã—ã¾ã—ãŸ                     45.2ç§’           â”‚â”‚
â”‚  â”‚                                                             â”‚â”‚
â”‚  â”‚  å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«:                                              â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚ ğŸ“Š report_2024_EN.xlsx                                 â”‚â”‚â”‚
â”‚  â”‚  â”‚    ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«          [é–‹ã] [ãƒ•ã‚©ãƒ«ãƒ€ã§è¡¨ç¤º]         â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚ ğŸ“Š report_2024_bilingual.xlsx                          â”‚â”‚â”‚
â”‚  â”‚  â”‚    å¯¾è¨³ãƒ•ã‚¡ã‚¤ãƒ«          [é–‹ã] [ãƒ•ã‚©ãƒ«ãƒ€ã§è¡¨ç¤º]         â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚â”‚
â”‚  â”‚  â”‚ ğŸ“‹ report_2024_glossary.csv                            â”‚â”‚â”‚
â”‚  â”‚  â”‚    ç”¨èªé›†CSV            [é–‹ã] [ãƒ•ã‚©ãƒ«ãƒ€ã§è¡¨ç¤º]          â”‚â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚â”‚
â”‚  â”‚                                                  [ é–‰ã˜ã‚‹ ] â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.6 å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«å‘½å

| Output Type | Input | Output |
|-------------|-------|--------|
| ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ« (JPâ†’EN) | `report.xlsx` | `report_translated.xlsx` |
| å¯¾è¨³ãƒ•ã‚¡ã‚¤ãƒ« | `report.xlsx` | `report_bilingual.xlsx` |
| ç”¨èªé›†CSV | `report.xlsx` | `report_glossary.csv` |

**PDFå¯¾è¨³å‡ºåŠ›:**
| Output Type | Input | Output |
|-------------|-------|--------|
| å¯¾è¨³PDF | `report.pdf` | `report_bilingual.pdf` |

### 5.7 ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚º

**å›ºå®šã‚µã‚¤ã‚º:** 1400Ã—850 ãƒ”ã‚¯ã‚»ãƒ«ï¼ˆãƒãƒ¼ãƒˆPC 1920Ã—1200 å‘ã‘ã«è¨­è¨ˆï¼‰

**ç‰¹å¾´:**
- **å›ºå®šã‚µã‚¤ã‚º**: å‹•çš„ãªã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¯è¡Œã‚ãªã„
- **å¤–éƒ¨ãƒ¢ãƒ‹ã‚¿ãƒ¼å¯¾å¿œ**: å¤–éƒ¨ãƒ¢ãƒ‹ã‚¿ãƒ¼ã¸ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¯OSã®DPIè¨­å®šã«ä»»ã›ã‚‹
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `window_width`/`window_height`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 1400Ã—850ï¼‰ã§å¤‰æ›´å¯èƒ½

### 5.8 ã‚«ãƒ©ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  (Material Design 3)

```css
:root {
  /* Primary - Professional indigo palette */
  --md-sys-color-primary: #4355B9;
  --md-sys-color-primary-container: #DEE0FF;
  --md-sys-color-on-primary: #FFFFFF;
  --md-sys-color-on-primary-container: #00105C;

  /* Secondary - Neutral blue-gray */
  --md-sys-color-secondary: #595D72;
  --md-sys-color-secondary-container: #DDE1F9;

  /* Surface */
  --md-sys-color-surface: #FEFBFF;
  --md-sys-color-surface-container: #F2EFF4;
  --md-sys-color-surface-container-high: #ECE9EE;
  --md-sys-color-on-surface: #1B1B1F;
  --md-sys-color-on-surface-variant: #46464F;

  /* Outline */
  --md-sys-color-outline: #777680;
  --md-sys-color-outline-variant: #C7C5D0;

  /* Status */
  --md-sys-color-error: #BA1A1A;
  --md-sys-color-success: #1B6B3D;
}
```

### 5.9 ã‚·ã‚§ã‚¤ãƒ—ã‚·ã‚¹ãƒ†ãƒ 

```css
:root {
  --md-sys-shape-corner-full: 9999px;   /* Pills, FABs */
  --md-sys-shape-corner-large: 20px;    /* Cards, Dialogs */
  --md-sys-shape-corner-medium: 16px;   /* Inputs, Chips */
  --md-sys-shape-corner-small: 12px;    /* Small elements */
}
```

### 5.10 ãƒ•ã‚©ãƒ³ãƒˆ

```css
font-family: 'Meiryo UI', 'Meiryo', 'Yu Gothic UI',
             'Hiragino Sans', 'Noto Sans JP', sans-serif;
```

---

## 6. ã‚µãƒ¼ãƒ“ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼

### 6.1 CopilotHandler

M365 Copilot ã¨ã®é€šä¿¡ã‚’æ‹…å½“ã€‚

```python
# ã‚¹ãƒ¬ãƒƒãƒ‰ã‚»ãƒ¼ãƒ•ãªé…å»¶ã‚¤ãƒ³ãƒãƒ¼ãƒˆç®¡ç†
class PlaywrightManager:
    """Playwrightãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®é…å»¶èª­ã¿è¾¼ã¿ï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã®ã‚¨ãƒ©ãƒ¼å›é¿ï¼‰"""
    def get_playwright()       # playwright types ã¨ sync_playwright ã‚’è¿”ã™
    def get_async_playwright() # async_playwright ã‚’è¿”ã™
    def get_error_types()      # Playwrightä¾‹å¤–å‹ã‚’è¿”ã™

# ã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œç®¡ç†ï¼ˆgreenletã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¯¾å¿œï¼‰
class PlaywrightThreadExecutor:
    """Playwrightæ“ä½œã‚’å°‚ç”¨ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œï¼ˆasyncio.to_threadã‹ã‚‰ã®å‘¼ã³å‡ºã—å¯¾å¿œï¼‰"""
    def start()               # ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰é–‹å§‹
    def stop()                # ã‚¹ãƒ¬ãƒƒãƒ‰åœæ­¢
    def execute(func, *args, timeout=120)  # é–¢æ•°ã‚’å°‚ç”¨ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œ

class CopilotHandler:
    COPILOT_URL = "https://m365.cloud.microsoft/chat/?auth=2"
    cdp_port = 9333  # Edge CDPå°‚ç”¨ãƒãƒ¼ãƒˆ

    def connect() -> bool:
        """
        1. EdgeãŒèµ·å‹•ã—ã¦ã„ãªã‘ã‚Œã°èµ·å‹•ï¼ˆå°‚ç”¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ä½¿ç”¨ï¼‰
        2. Playwrightã§æ¥ç¶šï¼ˆPlaywrightThreadExecutorçµŒç”±ï¼‰
        3. Copilotãƒšãƒ¼ã‚¸ã‚’é–‹ã
        4. ãƒãƒ£ãƒƒãƒˆå…¥åŠ›æ¬„ã®æº–å‚™å®Œäº†ã‚’å¾…æ©Ÿ
        5. ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒï¼ˆstorage_state.jsonï¼‰
        """

    def translate_sync(texts: list[str], prompt: str, reference_files: list[Path]) -> list[str]:
        """
        1. GPT-5ãƒˆã‚°ãƒ«ã‚’æœ‰åŠ¹åŒ–ï¼ˆé€ä¿¡å‰ã«ç¢ºèªï¼‰
        2. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’Copilotã«é€ä¿¡ï¼ˆé€ä¿¡ãƒœã‚¿ãƒ³æœ‰åŠ¹åŒ–ã‚’å¾…æ©Ÿï¼‰
        3. å¿œç­”ã‚’å¾…æ©Ÿï¼ˆå®‰å®šã™ã‚‹ã¾ã§ï¼‰
        4. çµæœã‚’ãƒ‘ãƒ¼ã‚¹
        5. ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ä¿å­˜
        """

    def translate_single(text: str, prompt: str, reference_files: list[Path]) -> str:
        """å˜ä¸€ãƒ†ã‚­ã‚¹ãƒˆç¿»è¨³ï¼ˆç”Ÿã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™ï¼‰"""

    def disconnect() -> None:
        """ãƒ–ãƒ©ã‚¦ã‚¶æ¥ç¶šã‚’çµ‚äº†"""

    def _ensure_gpt5_enabled(max_wait: float = 1.0) -> bool:
        """
        GPT-5ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ã‚’ç¢ºèªãƒ»æœ‰åŠ¹åŒ–
        - é€ä¿¡ç›´å‰ã«å‘¼ã³å‡ºã—ï¼ˆé…å»¶æç”»å¯¾å¿œï¼‰
        - è¤‡æ•°ã®æ¤œå‡ºæ–¹æ³•ï¼ˆCSS selector + JS parent traversalï¼‰
        - ãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯é™ã‹ã«ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå°†æ¥ã®å¤‰æ›´å¯¾å¿œï¼‰
        """
```

**Edgeèµ·å‹•è¨­å®š:**
- Profile: `%LOCALAPPDATA%/YakuLingo/EdgeProfile`
- CDP Port: 9333
- ã‚ªãƒ—ã‚·ãƒ§ãƒ³: `--no-first-run --no-default-browser-check`

**ãƒ–ãƒ©ã‚¦ã‚¶æ“ä½œã®ä¿¡é ¼æ€§:**
- å›ºå®šsleep()ã®ä»£ã‚ã‚Šã«Playwrightã®`wait_for_selector`ã‚’ä½¿ç”¨
- é€ä¿¡ãƒœã‚¿ãƒ³: `:not([disabled])`æ¡ä»¶ã§æœ‰åŠ¹åŒ–ã‚’å¾…æ©Ÿ
- ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º: `div[role="menu"]`ã®è¡¨ç¤ºã‚’ç¢ºèª
- ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜: æ·»ä»˜ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã§ç¢ºèª
- GPT-5ãƒˆã‚°ãƒ«: é€ä¿¡ç›´å‰ã«çŠ¶æ…‹ç¢ºèªãƒ»å¿…è¦ã«å¿œã˜ã¦æœ‰åŠ¹åŒ–

**Copilotæ–‡å­—æ•°åˆ¶é™:**
- Free ãƒ©ã‚¤ã‚»ãƒ³ã‚¹: 8,000æ–‡å­—
- Paid ãƒ©ã‚¤ã‚»ãƒ³ã‚¹: 128,000æ–‡å­—

**å‹•çš„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåˆ‡ã‚Šæ›¿ãˆ:**
ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãŒ`copilot_char_limit`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 7,500æ–‡å­—ï¼‰ã‚’è¶…ãˆã‚‹å ´åˆã€è‡ªå‹•çš„ã«ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆï¼š
1. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜
2. Copilotã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜
3. ãƒˆãƒªã‚¬ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡: "Please follow the instructions in the attached file and translate accordingly."

ã“ã‚Œã«ã‚ˆã‚Šã€Freeã¨Paidã®ä¸¡æ–¹ã®Copilotãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å¯¾å¿œã€‚

### 6.2 TranslationService

ç¿»è¨³å‡¦ç†ã®ä¸­å¿ƒã‚¯ãƒ©ã‚¹ã€‚

```python
class TranslationService:
    processors = {
        '.xlsx': ExcelProcessor(),
        '.xls': ExcelProcessor(),
        '.docx': WordProcessor(),
        '.doc': WordProcessor(),
        '.pptx': PptxProcessor(),
        '.ppt': PptxProcessor(),
        '.pdf': PdfProcessor(),
    }

    def detect_language(text: str) -> str:
        """
        Copilotã‚’ä½¿ç”¨ã—ã¦è¨€èªã‚’æ¤œå‡º
        - detect_language.txt ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä½¿ç”¨
        - çµæœ: "æ—¥æœ¬èª", "è‹±èª", "ä¸­å›½èª" ç­‰
        """

    def translate_text(text, reference_files) -> TextTranslationResult:
        """
        ãƒ†ã‚­ã‚¹ãƒˆç¿»è¨³ï¼ˆè¨€èªè‡ªå‹•æ¤œå‡ºï¼‰
        - æ—¥æœ¬èªå…¥åŠ› â†’ è‹±èªï¼ˆè¤‡æ•°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        - ãã®ä»–å…¥åŠ› â†’ æ—¥æœ¬èªï¼ˆè§£èª¬ä»˜ãï¼‰
        """

    def translate_file(input_path, reference_files, on_progress) -> TranslationResult:
        """
        1. ãƒ—ãƒ­ã‚»ãƒƒã‚µã‚’å–å¾—
        2. ãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã‚’æŠ½å‡º
        3. ãƒãƒƒãƒç¿»è¨³å®Ÿè¡Œ
        4. ç¿»è¨³ã‚’é©ç”¨ã—ã¦å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
        """

    def get_file_info(file_path) -> FileInfo:
        """ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±å–å¾—"""
```

### 6.3 BatchTranslator

ãƒãƒƒãƒå‡¦ç†ã«ã‚ˆã‚‹åŠ¹ç‡çš„ãªç¿»è¨³ã€‚

```python
class BatchTranslator:
    MAX_BATCH_SIZE = 50         # ãƒ–ãƒ­ãƒƒã‚¯æ•°ä¸Šé™
    MAX_CHARS_PER_BATCH = 7000  # æ–‡å­—æ•°ä¸Šé™ï¼ˆCopilot Free 8000åˆ¶é™å¯¾å¿œï¼‰

    def translate_blocks(blocks, reference_files, on_progress) -> dict[str, str]:
        """
        1. ãƒ–ãƒ­ãƒƒã‚¯ã‚’ãƒãƒƒãƒã«åˆ†å‰²
        2. å„ãƒãƒƒãƒã‚’ç¿»è¨³
        3. çµæœã‚’ãƒãƒ¼ã‚¸
        """
```

---

## 7. ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ­ã‚»ãƒƒã‚µ

### 7.1 FileProcessor (åŸºåº•ã‚¯ãƒ©ã‚¹)

```python
class FileProcessor(ABC):
    @property
    def file_type(self) -> FileType
    @property
    def supported_extensions(self) -> list[str]

    def get_file_info(file_path: Path) -> FileInfo
    def extract_text_blocks(file_path: Path) -> Iterator[TextBlock]
    def apply_translations(input_path, output_path, translations, direction) -> None

    def should_translate(text: str) -> bool:
        """ç¿»è¨³å¯¾è±¡åˆ¤å®šï¼ˆç©ºæ–‡å­—ã€æ•°å€¤ã®ã¿ç­‰ã‚’é™¤å¤–ï¼‰"""
```

### 7.2 ç¿»è¨³åˆ¤å®šã‚¯ãƒ©ã‚¹

#### CellTranslator

Excelã‚»ãƒ«ã€Word/PowerPointãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒ«ç”¨ã®ç¿»è¨³åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã€‚

```python
class CellTranslator:
    SKIP_PATTERNS = [
        r'^[\d\s\.,\-\+\(\)\/]+$',           # æ•°å€¤ã®ã¿
        r'^\d{4}[-/]\d{1,2}[-/]\d{1,2}$',    # æ—¥ä»˜ (YYYY-MM-DD)
        r'^\d{1,2}[-/]\d{1,2}[-/]\d{4}$',    # æ—¥ä»˜ (DD/MM/YYYY)
        r'^[\w\.\-]+@[\w\.\-]+\.\w+$',       # ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
        r'^https?://\S+$',                    # URL
        r'^[A-Z]{2,5}[-_]?\d+$',             # ã‚³ãƒ¼ãƒ‰ï¼ˆABC-123ï¼‰
        r'^[\d\s%]+$',                        # ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆä»˜ãæ•°å€¤
        r'^[Â¥$â‚¬Â£]\s*[\d,\.]+$',               # é€šè²¨è¨˜å·ä»˜ãæ•°å€¤
        r'^\d+[å¹´æœˆæ—¥æ™‚åˆ†ç§’]',                  # æ—¥æœ¬èªæ—¥æ™‚
    ]

    def should_translate(text: str) -> bool:
        """ã‚¹ã‚­ãƒƒãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¸€è‡´ã—ãªã‘ã‚Œã°ç¿»è¨³å¯¾è±¡ï¼ˆ2æ–‡å­—æœªæº€ã‚‚é™¤å¤–ï¼‰"""
```

#### ParagraphTranslator

Word/PowerPointã®æœ¬æ–‡æ®µè½ç”¨ã®ç¿»è¨³åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã€‚

```python
class ParagraphTranslator:
    SKIP_PATTERNS = [
        r'^[\d\s\.,\-\+\(\)\/]+$',           # æ•°å€¤ã®ã¿
        r'^https?://\S+$',                    # URL
        r'^[\w\.\-]+@[\w\.\-]+\.\w+$',       # ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
    ]

    def should_translate(text: str) -> bool:
        """ã‚¹ã‚­ãƒƒãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¸€è‡´ã—ãªã‘ã‚Œã°ç¿»è¨³å¯¾è±¡"""

    def apply_translation_to_paragraph(para, translated_text: str) -> None:
        """
        æ®µè½ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¿æŒã—ãªãŒã‚‰ç¿»è¨³ã‚’é©ç”¨
        - æœ€åˆã®runã«ç¿»è¨³ãƒ†ã‚­ã‚¹ãƒˆã‚’è¨­å®š
        - æ®‹ã‚Šã®runã¯ã‚¯ãƒªã‚¢
        """
```

### 7.3 ExcelProcessor

```python
class ExcelProcessor(FileProcessor):
    """
    ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª:
    - Primary: xlwings (Windows/macOSã€Excelã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¿…è¦)
      - å›³å½¢ã€ã‚°ãƒ©ãƒ•ã€ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã®ã‚µãƒãƒ¼ãƒˆ
    - Fallback: openpyxl (Linux or Excelãªã—ç’°å¢ƒ)
      - ã‚»ãƒ«ã®ã¿å¯¾å¿œ

    ç¿»è¨³å¯¾è±¡:
    - ã‚»ãƒ«å€¤ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã®ã¿ï¼‰
    - å›³å½¢ãƒ†ã‚­ã‚¹ãƒˆ (xlwingsã®ã¿)
    - ã‚°ãƒ©ãƒ•ã‚¿ã‚¤ãƒˆãƒ« (xlwingsã®ã¿)
    - ã‚°ãƒ©ãƒ•è»¸ã‚¿ã‚¤ãƒˆãƒ« (xlwingsã®ã¿)

    ä¿æŒ:
    - æ•°å¼ï¼ˆç¿»è¨³ã—ãªã„ï¼‰
    - ã‚»ãƒ«æ›¸å¼ï¼ˆãƒ•ã‚©ãƒ³ãƒˆã€è‰²ã€ç½«ç·šï¼‰
    - åˆ—å¹…ã€è¡Œé«˜ã•
    - çµåˆã‚»ãƒ«
    - ç”»åƒ

    éå¯¾è±¡:
    - ã‚·ãƒ¼ãƒˆå
    - ã‚³ãƒ¡ãƒ³ãƒˆ
    - ãƒ˜ãƒƒãƒ€ãƒ¼/ãƒ•ãƒƒã‚¿ãƒ¼

    è¿½åŠ æ©Ÿèƒ½:
    - create_bilingual_workbook(): åŸæ–‡/è¨³æ–‡ã‚·ãƒ¼ãƒˆã‚’ä¸¦åˆ—é…ç½®
    - export_glossary_csv(): ç¿»è¨³ãƒšã‚¢ã‚’CSVå‡ºåŠ›
    """
```

### 7.4 WordProcessor

```python
class WordProcessor(FileProcessor):
    """
    ç¿»è¨³å¯¾è±¡:
    - æœ¬æ–‡æ®µè½ (ParagraphTranslator)
    - ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒ« (CellTranslator - Exceläº’æ›ãƒ­ã‚¸ãƒƒã‚¯)
    - ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ (ParagraphTranslator)

    ä¿æŒ:
    - æ®µè½ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆè¦‹å‡ºã—ã€æœ¬æ–‡ç­‰ï¼‰
    - ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ ãƒ»æ›¸å¼
    - ç”»åƒãƒ»ä½ç½®
    - ç®‡æ¡æ›¸ããƒ»ç•ªå·ãƒªã‚¹ãƒˆ
    - ãƒšãƒ¼ã‚¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ

    éå¯¾è±¡:
    - ãƒ˜ãƒƒãƒ€ãƒ¼/ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆç¿»è¨³ã—ãªã„ï¼‰

    è¿½åŠ æ©Ÿèƒ½:
    - create_bilingual_document(): åŸæ–‡â†’è¨³æ–‡ã®æ®µè½ã‚’äº¤äº’ã«é…ç½®
      - ã€ç¿»è¨³ã€‘ãƒ˜ãƒƒãƒ€ãƒ¼ã§è¨³æ–‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ˜ç¤º
      - ç½«ç·šã§åŸæ–‡/è¨³æ–‡ã‚’åˆ†é›¢
    """
```

### 7.5 PptxProcessor

```python
class PptxProcessor(FileProcessor):
    """
    ç¿»è¨³å¯¾è±¡:
    - å›³å½¢ãƒ†ã‚­ã‚¹ãƒˆ (ParagraphTranslator)
    - ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒ« (CellTranslator - Exceläº’æ›ãƒ­ã‚¸ãƒƒã‚¯)
    - ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒˆ (ParagraphTranslator)

    ä¿æŒ:
    - ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
    - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    - ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³
    - ç”»åƒãƒ»ã‚°ãƒ©ãƒ•

    è¿½åŠ æ©Ÿèƒ½:
    - create_bilingual_presentation(): åŸæ–‡â†’è¨³æ–‡ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’äº¤äº’ã«é…ç½®
      - XMLç›´æ¥æ“ä½œã§ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ãƒãƒ¼ã‚¸
      - presentation.xml.relsã«ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
    """
```

### 7.6 PdfProcessor

```python
class PdfProcessor(FileProcessor):
    """
    ä½¿ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª:
    - PyMuPDF (fitz): PDFèª­ã¿æ›¸ã
    - pdfminer.six: ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã€ãƒ•ã‚©ãƒ³ãƒˆç¨®åˆ¥åˆ¤å®šï¼ˆPDFMathTranslateæº–æ‹ ï¼‰
    - PP-DocLayout-L (PaddleOCR): ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè§£æã®ã¿ï¼ˆOCRã¯ä½¿ç”¨ã—ãªã„ï¼‰

    ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æŠ½å‡ºãƒ¢ãƒ¼ãƒ‰ï¼ˆPDFMathTranslateæº–æ‹ ï¼‰:
    - pdfminer: ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºï¼ˆæ­£ç¢ºãªæ–‡å­—ãƒ‡ãƒ¼ã‚¿ã€ãƒ•ã‚©ãƒ³ãƒˆæƒ…å ±ã€CIDå€¤ï¼‰
    - PP-DocLayout-L: æ®µè½æ¤œå‡ºã€èª­ã¿é †ã€å›³è¡¨/æ•°å¼ã®è­˜åˆ¥
    - OCRãªã—: ã‚¹ã‚­ãƒ£ãƒ³PDFã¯ã‚µãƒãƒ¼ãƒˆå¯¾è±¡å¤–

    PDFMathTranslateæº–æ‹ æ©Ÿèƒ½:
    - ä½ãƒ¬ãƒ™ãƒ«API: PDFã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã‚’ç›´æ¥ç”Ÿæˆï¼ˆé«˜ç²¾åº¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ¶å¾¡ï¼‰
    - æ—¢å­˜ãƒ•ã‚©ãƒ³ãƒˆå†åˆ©ç”¨: PDFã«åŸ‹ã‚è¾¼ã¾ã‚ŒãŸCID/Simpleãƒ•ã‚©ãƒ³ãƒˆã‚’æ¤œå‡ºãƒ»å†åˆ©ç”¨
    - ãƒ•ã‚©ãƒ³ãƒˆç¨®åˆ¥åˆ¤å®š: pdfminer.sixã§CID vs Simpleãƒ•ã‚©ãƒ³ãƒˆã‚’åˆ¤å®š
    - ãƒ•ã‚©ãƒ³ãƒˆã‚µãƒ–ã‚»ãƒƒãƒ†ã‚£ãƒ³ã‚°: æœªä½¿ç”¨ã‚°ãƒªãƒ•ã‚’å‰Šé™¤ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’å‰Šæ¸›

    ãƒ•ã‚©ãƒ³ãƒˆç¨®åˆ¥ã«å¿œã˜ãŸã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°:
    - EMBEDDED (æ–°è¦åŸ‹ã‚è¾¼ã¿): has_glyph()ã§ã‚°ãƒªãƒ•IDå–å¾— â†’ 4æ¡hex
    - CID (æ—¢å­˜CIDãƒ•ã‚©ãƒ³ãƒˆ): ord(c)ã‚’ãã®ã¾ã¾4æ¡hex
    - SIMPLE (æ—¢å­˜Simpleãƒ•ã‚©ãƒ³ãƒˆ): ord(c)ã‚’2æ¡hex

    ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ•ã‚©ãƒ³ãƒˆ:
    - ja: SourceHanSerifJP-Regular.ttf
    - en: Tiro
    - zh-CN: SourceHanSerifSC-Regular.ttf
    - ko: SourceHanSerifKR-Regular.ttf

    è¿½åŠ æ©Ÿèƒ½:
    - create_bilingual_pdf(): åŸæ–‡â†’è¨³æ–‡ã®ãƒšãƒ¼ã‚¸ã‚’äº¤äº’ã«é…ç½®
    - export_glossary_csv(): ç¿»è¨³ãƒšã‚¢ã‚’CSVå‡ºåŠ›
    """
```

---

## 8. ãƒ•ã‚©ãƒ³ãƒˆç®¡ç†

### 8.1 FontTypeDetector

å…ƒãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚©ãƒ³ãƒˆç¨®é¡ã‚’è‡ªå‹•æ¤œå‡ºã€‚

**æ˜æœç³»ãƒ‘ã‚¿ãƒ¼ãƒ³:**
- Mincho, æ˜æœ, Ming, Serif, Times, Georgia, Cambria, Palatino

**ã‚´ã‚·ãƒƒã‚¯ç³»ãƒ‘ã‚¿ãƒ¼ãƒ³:**
- Gothic, ã‚´ã‚·ãƒƒã‚¯, Sans, Arial, Helvetica, Calibri, Meiryo, ãƒ¡ã‚¤ãƒªã‚ª

### 8.2 ãƒ•ã‚©ãƒ³ãƒˆãƒãƒƒãƒ”ãƒ³ã‚°

ãƒ•ã‚©ãƒ³ãƒˆè¨­å®šãŒç°¡ç•¥åŒ–ã•ã‚Œã€ç¿»è¨³æ–¹å‘ã®ã¿ã§å‡ºåŠ›ãƒ•ã‚©ãƒ³ãƒˆã‚’æ±ºå®šï¼ˆå…ƒãƒ•ã‚©ãƒ³ãƒˆç¨®åˆ¥ã¯ç„¡è¦–ï¼‰ã€‚

| ç¿»è¨³æ–¹å‘ | å‡ºåŠ›ãƒ•ã‚©ãƒ³ãƒˆ |
|---------|-------------|
| JP â†’ EN | Arial |
| EN â†’ JP | MS Pã‚´ã‚·ãƒƒã‚¯ |

> **Note**: å…¨ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ï¼ˆExcel, Word, PowerPoint, PDFï¼‰ã§å…±é€šã®è¨­å®šã‚’ä½¿ç”¨ã€‚

### 8.3 ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´

| ç¿»è¨³æ–¹å‘ | èª¿æ•´ | æœ€å°ã‚µã‚¤ã‚º |
|---------|-----|----------|
| JP â†’ EN | ãªã— (0pt) | 6pt |
| EN â†’ JP | ãªã— | - |

**å‚™è€ƒ:** ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ã¯è¨­å®šã§å¤‰æ›´å¯èƒ½ï¼ˆ`font_size_adjustment_jp_to_en`ï¼‰ã€‚

---

## 9. ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­è¨ˆ

### 9.1 PromptBuilder

```python
class PromptBuilder:
    _template_cache: dict[str, str] = {}  # ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥

    def build(input_text, has_reference_files) -> str:
        """
        1. è¨€èªã‚’è‡ªå‹•æ¤œå‡º
        2. é©åˆ‡ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé¸æŠï¼ˆprompts/file_translate_*.txtï¼‰
        3. å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«æŒ‡ç¤ºã‚’æŒ¿å…¥ï¼ˆæ·»ä»˜æ™‚ã®ã¿ï¼‰
        4. å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆã‚’åŸ‹ã‚è¾¼ã¿
        """

    def build_batch(texts, has_reference_files) -> str:
        """ç•ªå·ä»˜ããƒªã‚¹ãƒˆã¨ã—ã¦å…¥åŠ›"""

    def get_text_template(style: str) -> str:
        """
        ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—ï¼ˆåˆå›ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
        - prompts/text_translate_to_en_{style}.txt
        - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚Šæ¯å›ã®ãƒ•ã‚¡ã‚¤ãƒ«I/Oã‚’å›é¿
        """
```

**ä¸¦åˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰ï¼ˆ3ãƒãƒƒãƒä»¥ä¸Šï¼‰:**
```python
if len(batches) >= 3:
    with ThreadPoolExecutor(max_workers=4) as executor:
        prompts = list(executor.map(build_prompt, batches))
```

### 9.2 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¾‹ï¼ˆJPâ†’ENï¼‰

```
Role Definition
ã‚ãªãŸã¯æ—¥æœ¬èªã‚’è‹±èªã«ç¿»è¨³ã™ã‚‹ã€å®Œå…¨è‡ªå‹•åŒ–ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿å‡¦ç†ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚
ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æŒ¨æ‹¶ã€èª¬æ˜ã€è¨€ã„è¨³ã€è£œè¶³æƒ…å ±ã¯ä¸€åˆ‡å‡ºåŠ›ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

Critical Rules (å„ªå…ˆé †ä½é †)

1. å‡ºåŠ›å½¢å¼å³å®ˆ
   ç¿»è¨³çµæœã®ã¿ã‚’å‡ºåŠ›ã€‚Markdownã®æ ã‚„è§£èª¬ã¯ä¸è¦ã€‚

2. è‡ªç„¶ãªç¿»è¨³
   - èª­ã¿ã‚„ã™ãè‡ªç„¶ãªè‹±èªã«ç¿»è¨³
   - éåº¦ãªçœç•¥ã¯é¿ã‘ã‚‹

3. æ•°å€¤è¡¨è¨˜ï¼ˆå¿…é ˆãƒ«ãƒ¼ãƒ«ï¼‰
   - å„„ â†’ oku (ä¾‹: 4,500å„„å†† â†’ 4,500 oku yen)
   - åƒå˜ä½ â†’ k (ä¾‹: 12,000 â†’ 12k)
   - è² æ•° â†’ () (ä¾‹: â–²50 â†’ (50))

{reference_section}

Input
{input_text}
```

### 9.3 å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«æŒ‡ç¤º

```
Reference Files
æ·»ä»˜ã®å‚è€ƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆç”¨èªé›†ã€å‚è€ƒè³‡æ–™ç­‰ï¼‰ã‚’å‚ç…§ã—ã€ç¿»è¨³ã«æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚
ç”¨èªé›†ãŒã‚ã‚‹å ´åˆã¯ã€è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ç”¨èªã¯å¿…ãšãã®è¨³èªã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚
```

---

## 10. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

### 10.1 HistoryDB

ç¿»è¨³å±¥æ­´ã‚’SQLiteã§æ°¸ç¶šåŒ–ã€‚

```python
class HistoryDB:
    """
    ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹: ~/.yakulingo/history.db

    ãƒ†ãƒ¼ãƒ–ãƒ«: history
    - id: INTEGER PRIMARY KEY
    - source_text: TEXT
    - result_json: TEXT (TextTranslationResult ã‚’JSONåŒ–)
    - timestamp: TEXT (ISO format)
    - created_at: TIMESTAMP
    """

    def add_entry(entry: HistoryEntry) -> int:
        """å±¥æ­´ã‚¨ãƒ³ãƒˆãƒªã‚’è¿½åŠ """

    def get_recent(limit: int = 50) -> List[HistoryEntry]:
        """æœ€è¿‘ã®å±¥æ­´ã‚’å–å¾—"""

    def search(query: str) -> List[HistoryEntry]:
        """ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢"""

    def delete_entry(entry_id: int) -> bool:
        """ã‚¨ãƒ³ãƒˆãƒªã‚’å‰Šé™¤"""

    def clear_all() -> None:
        """å…¨å±¥æ­´ã‚’å‰Šé™¤"""
```

### 10.2 ãƒ‡ãƒ¼ã‚¿ä¿å­˜å ´æ‰€

| ãƒ‡ãƒ¼ã‚¿ | ãƒ‘ã‚¹ |
|--------|------|
| ã‚¢ãƒ—ãƒªè¨­å®š | `config/settings.json` |
| ç¿»è¨³å±¥æ­´ | `~/.yakulingo/history.db` |
| å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ« | `glossary.csv`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ |

---

## 11. è‡ªå‹•æ›´æ–°

### 11.1 AutoUpdater

GitHub ReleasesçµŒç”±ã§è‡ªå‹•æ›´æ–°ã€‚

```python
class AutoUpdater:
    """
    GitHub Releases APIã‚’ä½¿ç”¨ã—ãŸè‡ªå‹•æ›´æ–°

    æ©Ÿèƒ½:
    - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
    - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ä»˜ãï¼‰
    - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆZIPå±•é–‹ï¼‰
    - Windows NTLMãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ
    """

    def check_for_updates() -> Optional[VersionInfo]:
        """æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯"""

    def download_update(version_info: VersionInfo, on_progress: Callable) -> Path:
        """ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰"""

    def install_update(downloaded_path: Path) -> bool:
        """ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"""
```

### 11.2 ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œ

```python
# Windowsã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ã‚­ã‚·ã‚’è‡ªå‹•æ¤œå‡º
# ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‹ã‚‰è¨­å®šã‚’èª­ã¿å–ã‚Š

# NTLMèªè¨¼ãƒ—ãƒ­ã‚­ã‚·å¯¾å¿œï¼ˆpywin32ãŒå¿…è¦ï¼‰
if HAS_PYWIN32:
    # SSPIçµŒç”±ã§NTLMèªè¨¼
```

### 11.3 æ›´æ–°ãƒ•ãƒ­ãƒ¼

```
1. ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯
2. æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‚Œã°é€šçŸ¥ã‚’è¡¨ç¤º
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œæ›´æ–°ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒ­ã‚°ãƒ¬ã‚¹è¡¨ç¤ºï¼‰
5. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Œäº†å¾Œã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª
6. ã‚¢ãƒ—ãƒªå†èµ·å‹•ã§æ›´æ–°å®Œäº†
```

---

## 12. è¨­å®šãƒ»é…å¸ƒ

### 12.1 AppSettings

```python
@dataclass
class AppSettings:
    # Reference Files (ç”¨èªé›†ã€å‚è€ƒè³‡æ–™ãªã©)
    reference_files: list[str] = ["glossary.csv"]
    output_directory: Optional[str] = None  # None = å…¥åŠ›ã¨åŒã˜

    # UI
    last_tab: str = "text"
    window_width: int = 1400              # 3ã‚«ãƒ©ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¯¾å¿œ
    window_height: int = 850

    # Advanced
    max_chars_per_batch: int = 7000      # Copilot Free 8000åˆ¶é™å¯¾å¿œ
    request_timeout: int = 120
    max_retries: int = 3

    # Copilot License
    copilot_char_limit: int = 7500       # ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜åˆ‡ã‚Šæ›¿ãˆé–¾å€¤

    # File Translation Options
    bilingual_output: bool = False       # å¯¾è¨³å‡ºåŠ›ï¼ˆåŸæ–‡ã¨ç¿»è¨³ã‚’äº¤äº’ã«é…ç½®ï¼‰
    export_glossary: bool = False        # å¯¾è¨³CSVå‡ºåŠ›ï¼ˆglossaryã¨ã—ã¦å†åˆ©ç”¨å¯èƒ½ï¼‰
    translation_style: str = "concise"   # ãƒ•ã‚¡ã‚¤ãƒ«ç¿»è¨³ã®è‹±è¨³ã‚¹ã‚¿ã‚¤ãƒ«

    # Text Translation Options
    text_translation_style: str = "concise"  # "standard", "concise", "minimal"

    # Font Settings (å…¨ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼å…±é€š)
    font_size_adjustment_jp_to_en: float = 0.0  # ptï¼ˆ0ã§èª¿æ•´ãªã—ï¼‰
    font_size_min: float = 6.0                  # ptï¼ˆæœ€å°ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºï¼‰
    font_jp_to_en: str = "Arial"                # è‹±è¨³æ™‚ã®å‡ºåŠ›ãƒ•ã‚©ãƒ³ãƒˆ
    font_en_to_jp: str = "MS Pã‚´ã‚·ãƒƒã‚¯"         # å’Œè¨³æ™‚ã®å‡ºåŠ›ãƒ•ã‚©ãƒ³ãƒˆ

    # PDF Layout Options (PP-DocLayout-L)
    ocr_batch_size: int = 5              # ãƒšãƒ¼ã‚¸/ãƒãƒƒãƒ
    ocr_dpi: int = 200                   # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè§£æè§£åƒåº¦
    ocr_device: str = "auto"             # "auto", "cpu", "cuda"

    # Auto Update
    auto_update_enabled: bool = True
    auto_update_check_interval: int = 86400  # 24æ™‚é–“
    github_repo_owner: str = "minimo162"
    github_repo_name: str = "yakulingo"
    last_update_check: Optional[str] = None
    skipped_version: Optional[str] = None
```

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«:** `config/settings.json`

### 12.2 èµ·å‹•æ–¹æ³•

```bash
# é–‹ç™ºç’°å¢ƒ
python app.py

# é…å¸ƒç‰ˆ
YakuLingo.exe    # Rustè£½ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ãƒ³ãƒãƒ£ãƒ¼
```

### 12.3 èµ·å‹•ãƒ•ãƒ­ãƒ¼

```
1. main()ã§multiprocessing.freeze_support()ã‚’å‘¼ã³å‡ºã—ï¼ˆWindows/PyInstallerå¯¾å¿œï¼‰
2. PYWEBVIEW_GUI=edgechromiumç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼ˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å›é¿ï¼‰
3. ãƒ­ã‚®ãƒ³ã‚°è¨­å®šï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ï¼‰
4. NiceGUI importã‚’é…å»¶å®Ÿè¡Œï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã§ã®äºŒé‡åˆæœŸåŒ–ã‚’å›é¿ï¼‰
5. pywebviewã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’èµ·å‹•
6. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’å³åº§ã«è¡¨ç¤ºï¼ˆawait client.connected()å¾Œã«UIæ§‹ç¯‰ï¼‰
7. NiceGUIã‚µãƒ¼ãƒãƒ¼èµ·å‹•ï¼ˆport=8765, reconnect_timeout=30.0ï¼‰
8. Copilotæ¥ç¶šé–‹å§‹ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã€PlaywrightThreadExecutorã§å°‚ç”¨ã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œï¼‰
9. è‡ªå‹•æ›´æ–°ãƒã‚§ãƒƒã‚¯ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
10. æ¥ç¶šå®Œäº†å¾Œã€ç¿»è¨³æ©Ÿèƒ½ãŒæœ‰åŠ¹åŒ–
```

**èµ·å‹•æœ€é©åŒ–ãƒã‚¤ãƒ³ãƒˆ:**
- NiceGUI importã‚’`main()`å†…ã«é…ç½®ã—ã€pywebviewã®multiprocessingã«ã‚ˆã‚‹äºŒé‡åˆæœŸåŒ–ã‚’å›é¿
- `show=False`ã§ãƒ–ãƒ©ã‚¦ã‚¶è‡ªå‹•èµ·å‹•ã‚’æŠ‘åˆ¶ï¼ˆãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ã¯pywebviewã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’ä½¿ç”¨ï¼‰
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’å…ˆè¡Œè¡¨ç¤ºã—ã€ä½“æ„Ÿèµ·å‹•é€Ÿåº¦ã‚’å‘ä¸Š

### 12.4 ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

| é …ç›® | è¦ä»¶ |
|------|------|
| OS | Windows 10/11 |
| Python | 3.11+ |
| Browser | Microsoft Edge |
| M365 | Copilot ã‚¢ã‚¯ã‚»ã‚¹æ¨© |

### 12.5 ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```
nicegui>=1.4.0
pywebview>=5.0.0
playwright>=1.40.0
openpyxl>=3.1.0
python-docx>=1.1.0
python-pptx>=0.6.23
PyMuPDF>=1.24.0
pdfminer.six>=20231228
pillow>=10.0.0
numpy>=1.24.0
```

### 12.6 ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¾å­˜

```
# ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè§£æã‚µãƒãƒ¼ãƒˆ (PP-DocLayout-L)
paddleocr>=3.0.0
paddlepaddle>=3.0.0

# Windows NTLMãƒ—ãƒ­ã‚­ã‚·
pywin32>=306

# ãƒ†ã‚¹ãƒˆ
pytest>=8.0.0
pytest-cov>=5.0.0
pytest-asyncio>=0.23.0
```

### 12.7 é…å¸ƒ

ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å…±æœ‰ã‹ã‚‰ã®ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾å¿œã€‚

```bash
# é…å¸ƒãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ
packaging\make_distribution.bat

# å‡ºåŠ›
share_package/
â”œâ”€â”€ setup.vbs          # ãƒ¦ãƒ¼ã‚¶ãƒ¼å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ YakuLingo_*.zip    # é…å¸ƒãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â””â”€â”€ .scripts/
    â””â”€â”€ setup.ps1      # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```

è©³ç´°ã¯ `docs/DISTRIBUTION.md` ã‚’å‚ç…§ã€‚

---

## 13. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 13.1 èµ·å‹•æ™‚é–“æœ€é©åŒ–

#### é…å»¶ã‚¤ãƒ³ãƒãƒ¼ãƒˆ (Lazy Import)

é‡ã„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®èª­ã¿è¾¼ã¿ã‚’åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã¾ã§é…å»¶ã•ã›ã‚‹ã“ã¨ã§ã€èµ·å‹•æ™‚é–“ã‚’çŸ­ç¸®ã€‚

```python
# yakulingo/processors/__init__.py
_LAZY_IMPORTS = {
    'ExcelProcessor': 'excel_processor',
    'WordProcessor': 'word_processor',
    'PptxProcessor': 'pptx_processor',
    'PdfProcessor': 'pdf_processor',
}

_SUBMODULES = {'excel_processor', 'word_processor', 'pptx_processor', 'pdf_processor'}

def __getattr__(name: str):
    """é…å»¶ãƒ­ãƒ¼ãƒ‰: åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã«ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ"""
    import importlib
    if name in _SUBMODULES:
        return importlib.import_module(f'.{name}', __package__)
    if name in _LAZY_IMPORTS:
        module_name = _LAZY_IMPORTS[name]
        module = importlib.import_module(f'.{module_name}', __package__)
        return getattr(module, name)
    raise AttributeError(f"module {__name__!r} has no attribute {name!r}")
```

**é©ç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸:**
- `yakulingo.processors` - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ­ã‚»ãƒƒã‚µï¼ˆExcel, Word, PowerPoint, PDFï¼‰
- `yakulingo.services` - ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆCopilotHandler, AutoUpdaterç­‰ï¼‰
- `yakulingo.ui` - UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆYakuLingoAppç­‰ï¼‰

**`_SUBMODULES`ãƒ‘ã‚¿ãƒ¼ãƒ³:**
`unittest.mock.patch`ã§ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ‘ãƒƒãƒã™ã‚‹å ´åˆã«å¿…è¦ã€‚ã“ã‚Œã«ã‚ˆã‚Š`patch('yakulingo.processors.excel_processor')`ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã€‚

#### WebSocketæ¥ç¶šæœ€é©åŒ–

NiceGUIã®WebSocketæ¥ç¶šã‚’å®‰å®šåŒ–ã™ã‚‹ãŸã‚ã€`reconnect_timeout`ã‚’èª¿æ•´ã€‚

```python
# yakulingo/ui/app.py
ui.run(
    ...
    reconnect_timeout=30.0,  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ3ç§’ã‹ã‚‰30ç§’ã«å¢—åŠ 
)
```

**åŠ¹æœ:**
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®3ç§’ã§ã¯ping_interval=4ç§’ã€ping_timeout=2ç§’
- 30ç§’ã«è¨­å®šã™ã‚‹ã¨æ¥ç¶šã®å®‰å®šæ€§ãŒå¤§å¹…ã«å‘ä¸Š
- é•·æ™‚é–“ã®ç¿»è¨³æ“ä½œä¸­ã‚‚æ¥ç¶šãŒç¶­æŒã•ã‚Œã‚‹

#### éåŒæœŸå‡¦ç†ã®æœ€é©åŒ–

ã™ã¹ã¦ã®ç¿»è¨³æ“ä½œã¯`asyncio.to_thread()`ã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰ã«ã‚ªãƒ•ãƒ­ãƒ¼ãƒ‰ã—ã€NiceGUIã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„ã€‚

```python
# yakulingo/ui/app.py
async def _translate_text(self):
    client = self._client  # ä¿å­˜ã•ã‚ŒãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå‚ç…§ã‚’ä½¿ç”¨

    result = await asyncio.to_thread(
        self.translation_service.translate_text_with_options,
        source_text,
        reference_files,
    )

    with client:  # UIã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å¾©å…ƒ
        self._refresh_content()
```

**é‡è¦**: NiceGUIã®`context.client`ã¯éåŒæœŸã‚¿ã‚¹ã‚¯å†…ã§åˆ©ç”¨ä¸å¯ï¼ˆã‚¹ãƒ­ãƒƒãƒˆã‚¹ã‚¿ãƒƒã‚¯ãŒç©ºï¼‰ã€‚
`@ui.page`ãƒãƒ³ãƒ‰ãƒ©ã§`self._client = client`ã¨ã—ã¦ä¿å­˜ã—ã€éåŒæœŸãƒãƒ³ãƒ‰ãƒ©ã§ä½¿ç”¨ã™ã‚‹ã€‚

**å¯¾è±¡ãƒ¡ã‚½ãƒƒãƒ‰:**
- `_translate_text()` - ãƒ†ã‚­ã‚¹ãƒˆç¿»è¨³
- `_adjust_text()` - ç¿»è¨³èª¿æ•´
- `_back_translate()` - æˆ»ã—è¨³
- `_follow_up_action()` - ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
- `_translate_file()` - ãƒ•ã‚¡ã‚¤ãƒ«ç¿»è¨³

#### Playwrightã‚¹ãƒ¬ãƒƒãƒ‰ãƒ¢ãƒ‡ãƒ«

Playwrightã®sync APIã¯greenletã‚’ä½¿ç”¨ã—ã€åˆæœŸåŒ–ã•ã‚ŒãŸã‚¹ãƒ¬ãƒƒãƒ‰ã§ã®ã¿å‹•ä½œã™ã‚‹ã€‚
`PlaywrightThreadExecutor`ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ãŒå°‚ç”¨ã‚¹ãƒ¬ãƒƒãƒ‰ã§å…¨Playwrightæ“ä½œã‚’å®Ÿè¡Œã€‚

```python
# yakulingo/services/copilot_handler.py
def translate_sync(self, texts, prompt, ...) -> list[str]:
    # asyncio.to_thread()ã‹ã‚‰å‘¼ã°ã‚Œã¦ã‚‚ã‚¹ãƒ¬ãƒƒãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¨ãƒ©ãƒ¼ã‚’å›é¿
    return _playwright_executor.execute(
        self._translate_sync_impl, texts, prompt, ...
    )
```

ã“ã‚Œã«ã‚ˆã‚Šã€UIã®`asyncio.to_thread()`ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã¦ã‚‚ã€
Playwrightæ“ä½œã¯å¸¸ã«æ­£ã—ã„ã‚¹ãƒ¬ãƒƒãƒ‰ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã§å®Ÿè¡Œã•ã‚Œã‚‹ã€‚

### 13.2 ãƒ©ãƒ³ã‚¿ã‚¤ãƒ æœ€é©åŒ–

#### æ­£è¦è¡¨ç¾ã®äº‹å‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«

é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¬ãƒ™ãƒ«ã§äº‹å‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã€‚

```python
# yakulingo/ui/utils.py
_RE_BOLD = re.compile(r'\*\*([^*]+)\*\*')
_RE_QUOTE = re.compile(r'"([^"]+)"')
_RE_TRANSLATION_TEXT = re.compile(r'è¨³æ–‡:\s*(.+?)(?=è§£èª¬:|$)', re.DOTALL)
_RE_EXPLANATION = re.compile(r'è§£èª¬:\s*(.+)', re.DOTALL)

# yakulingo/services/translation_service.py
_RE_MULTI_OPTION = re.compile(r'\[(\d+)\]\s*è¨³æ–‡:\s*(.+?)\s*è§£èª¬:\s*(.+?)(?=\[\d+\]|$)', re.DOTALL)
_RE_MARKDOWN_SEPARATOR = re.compile(r'\n?\s*[\*\-]{3,}\s*')

# yakulingo/services/copilot_handler.py
_RE_NUMBERING_PREFIX = re.compile(r'^\d+\.\s*(.+)')
```

**æœ€é©åŒ–åŠ¹æœ:**
- æ¯å›ã®`re.compile()`å‘¼ã³å‡ºã—ã‚’å›é¿
- è¤‡æ•°å›ä½¿ç”¨æ™‚ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚³ã‚¹ãƒˆã‚’å‰Šæ¸›

#### é…å»¶ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ‘ã‚¿ãƒ¼ãƒ³

ä½¿ç”¨é »åº¦ãŒä½ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã¯é…å»¶ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã§åˆå›ä½¿ç”¨æ™‚ã®ã¿ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã€‚

```python
# yakulingo/processors/font_manager.py
class FontTypeDetector:
    _compiled_mincho: Optional[list] = None
    _compiled_gothic: Optional[list] = None

    @classmethod
    def _get_mincho_patterns(cls) -> list:
        if cls._compiled_mincho is None:
            cls._compiled_mincho = [
                re.compile(p, re.IGNORECASE)
                for p in cls.MINCHO_PATTERNS
            ]
        return cls._compiled_mincho
```

#### å¥èª­ç‚¹åˆ¤å®šã®æœ€é©åŒ–

`unicodedata`ã‚«ãƒ†ã‚´ãƒªã®å…ˆé ­æ–‡å­—ãƒã‚§ãƒƒã‚¯ã§å¥èª­ç‚¹åˆ¤å®šã‚’é«˜é€ŸåŒ–ã€‚

```python
# Before (é…ã„)
def _is_punctuation(char: str) -> bool:
    cat = unicodedata.category(char)
    return cat.startswith('P')  # æ–‡å­—åˆ—ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—

# After (é«˜é€Ÿ)
def _is_punctuation(char: str) -> bool:
    cat = unicodedata.category(char)
    return cat[0] == 'P'  # ç›´æ¥ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚¢ã‚¯ã‚»ã‚¹
```

### 13.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æœ€é©åŒ–

#### ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ­ãƒ¼ã‚«ãƒ«æ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°

SQLiteæ¥ç¶šã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ã”ã¨ã«å†åˆ©ç”¨ã—ã€æ¥ç¶šã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å‰Šæ¸›ã€‚

```python
# yakulingo/storage/history_db.py
class HistoryDB:
    _local = threading.local()

    def _get_connection(self) -> sqlite3.Connection:
        if not hasattr(self._local, 'conn') or self._local.conn is None:
            self._local.conn = sqlite3.connect(
                self.db_path,
                timeout=DB_TIMEOUT,
                check_same_thread=False
            )
            self._local.conn.execute('PRAGMA journal_mode=WAL')
        return self._local.conn
```

**WALãƒ¢ãƒ¼ãƒ‰:**
Write-Ahead Loggingãƒ¢ãƒ¼ãƒ‰ã«ã‚ˆã‚Šã€èª­ã¿å–ã‚Šã¨æ›¸ãè¾¼ã¿ã®ä¸¦è¡Œå®Ÿè¡ŒãŒå¯èƒ½ã€‚

### 13.4 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ¸¬å®š

èµ·å‹•æ™‚é–“ã®æ¸¬å®š:
```bash
python -c "import time; t=time.time(); from yakulingo.ui import run_app; print(f'Import: {time.time()-t:.3f}s')"
```

---

## å¤‰æ›´å±¥æ­´

### 2.15 (2025-12)
- PDFç¿»è¨³: yomitokuã‚’PP-DocLayout-Lã«ç½®ãæ›ãˆï¼ˆApache-2.0ã€å•†ç”¨åˆ©ç”¨å¯ï¼‰
- PDFç¿»è¨³: 23ã‚«ãƒ†ã‚´ãƒªã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ¤œå‡ºï¼ˆ90.4% mAP@0.5ï¼‰
- PDFç¿»è¨³: CPUã§ã‚‚å‹•ä½œå¯èƒ½ï¼ˆ~760ms/ãƒšãƒ¼ã‚¸ï¼‰

### 2.14 (2025-12)
- PDFç¿»è¨³: OCRã‚’å»ƒæ­¢ã—LayoutAnalyzerã«åˆ‡ã‚Šæ›¿ãˆï¼ˆPDFMathTranslateæº–æ‹ ï¼‰
- PDFç¿»è¨³: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æŠ½å‡ºï¼ˆpdfminerãƒ†ã‚­ã‚¹ãƒˆ + PP-DocLayout-Lãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰
- ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š: 4è¨­å®šâ†’2è¨­å®šã«ç°¡ç•¥åŒ–ï¼ˆç¿»è¨³æ–¹å‘ã®ã¿ã§æ±ºå®šï¼‰
- ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š: PDFå°‚ç”¨è¨­å®šã‚’å»ƒæ­¢ã—å…¨å½¢å¼ã§å…±é€šè¨­å®šã‚’ä½¿ç”¨

### 2.13 (2025-12)
- PDFç¿»è¨³: æ—¢å­˜ãƒ•ã‚©ãƒ³ãƒˆå†åˆ©ç”¨æ©Ÿèƒ½è¿½åŠ ï¼ˆPDFMathTranslateæº–æ‹ ï¼‰
- PDFç¿»è¨³: pdfminer.sixã«ã‚ˆã‚‹CID/Simpleãƒ•ã‚©ãƒ³ãƒˆç¨®åˆ¥åˆ¤å®š
- PDFç¿»è¨³: é«˜ãƒ¬ãƒ™ãƒ«APIãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å‰Šé™¤ã—ä½ãƒ¬ãƒ™ãƒ«APIã«çµ±ä¸€

### 2.12 (2025-12)
- PDFç¿»è¨³ç²¾åº¦å‘ä¸Šï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿæ§‹ã€æ•°å¼æ¤œå‡ºã€ãƒ•ã‚©ãƒ³ãƒˆèª¿æ•´ã®æ”¹å–„ï¼‰
- ä¸­å›½èªâ†’æ—¥æœ¬èªç¿»è¨³æ™‚ã®ã‚¹ã‚­ãƒƒãƒ—åˆ¤å®šã‚’ä¿®æ­£
- ãƒ•ã‚¡ã‚¤ãƒ«ç¿»è¨³ã®è¨€èªé¸æŠUIãƒ©ãƒ™ãƒ«ã‚’æ˜ç¢ºåŒ–
- Windowsã®DPIã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°å¯¾å¿œã‚’æ”¹å–„
- ã‚¢ãƒ—ãƒªçµ‚äº†æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã‚’ç¢ºå®Ÿã«å®Ÿè¡Œ
- Excelå›³å½¢ãƒ†ã‚­ã‚¹ãƒˆå–å¾—æ™‚ã®COMã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’æœ€é©åŒ–
- è‡ªå‹•æ›´æ–°æ™‚ã«glossary.csvã¨settings.jsonã‚’ä¸Šæ›¸ãã™ã‚‹ã‚ˆã†ã«å¤‰æ›´

### 2.11 (2025-12)
- ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’å›ºå®šï¼ˆ1400Ã—850ã€ãƒãƒ¼ãƒˆPC 1920Ã—1200 å‘ã‘ï¼‰
- å‹•çš„ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¨CSSã‚ºãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã€OSã®DPIè¨­å®šã«ä»»ã›ã‚‹
- ç¿»è¨³ãƒ‘ãƒãƒ«ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ”¹å–„ï¼ˆ2/3å¹…ãƒ»ä¸­å¤®æƒãˆï¼‰
- ç¿»è¨³ä¸­ã¨ç¿»è¨³å¾Œã®å…¥åŠ›ãƒ‘ãƒãƒ«è¡¨ç¤ºã‚’çµ±ä¸€

### 2.10 (2025-12)
- ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Œäº†å¾Œã«YakuLingoã‚’è‡ªå‹•èµ·å‹•
- AppDataã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‡¦ç†ã‚’å‰Šé™¤ï¼ˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ä¸Šæ›¸ãã•ã‚Œãªã„ãŸã‚ä¸è¦ï¼‰
- ãƒ•ã‚©ãƒ³ãƒˆèª­ã¿è¾¼ã¿å®Œäº†å‰ã«ã‚¢ã‚¤ã‚³ãƒ³ãŒãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºã•ã‚Œã‚‹å•é¡Œã‚’ä¿®æ­£
- å·¦ã‚«ãƒ©ãƒ ã®ã‚¿ãƒ–ã‚’å¤§ããè¦‹ã‚„ã™ãæ”¹å–„
- å±¥æ­´ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®æ–‡å­—åˆ‡ã‚Šè©°ã‚ã‚’CSSã«å§”ä»»

### 2.9 (2025-12)
- ç¿»è¨³é€Ÿåº¦ã®æœ€é©åŒ–ï¼ˆãƒ†ã‚­ã‚¹ãƒˆãƒ»ãƒ•ã‚¡ã‚¤ãƒ«ç¿»è¨³ã®ãƒãƒ¼ãƒªãƒ³ã‚°é–“éš”çŸ­ç¸®ï¼‰
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½è¿½åŠ ï¼ˆPromptBuilderï¼‰
- 3ãƒãƒƒãƒä»¥ä¸Šã®ä¸¦åˆ—ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰ï¼ˆThreadPoolExecutorï¼‰

### 2.8 (2025-12)
- ç¿»è¨³çµæœãƒ‘ãƒãƒ«ã«åŸæ–‡ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ç¿»è¨³çŠ¶æ…‹è¡¨ç¤ºã‚’è¿½åŠ 
- å…¥åŠ›æ¬„ã‚’ç¸¦å¹…ã„ã£ã±ã„ã«æ‹¡å¼µ

### 2.7 (2025-12)
- Copilotã«ã‚ˆã‚‹è¨€èªæ¤œå‡ºæ©Ÿèƒ½è¿½åŠ ï¼ˆ`detect_language()`ï¼‰
- è¨€èªæ¤œå‡ºãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¿½åŠ 

### 2.6 (2025-12)
- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢è¿½åŠ ã€ãƒ†ã‚­ã‚¹ãƒˆç¿»è¨³UIç°¡ç´ åŒ–ï¼ˆ1è¨³æ–‡+ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³èª¿æ•´ï¼‰
- ç¿»è¨³ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®šè¿½åŠ ã€Rustè£½ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ©ãƒ³ãƒãƒ£ãƒ¼å¯¾å¿œ

### 2.5 (2025-12)
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆé…å»¶ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€æ­£è¦è¡¨ç¾äº‹å‰ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã€DBæ¥ç¶šãƒ—ãƒ¼ãƒªãƒ³ã‚°ï¼‰
- ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºè¨­å®šå¯¾å¿œ

### 2.4 (2025-12)
- å¯¾è¨³å‡ºåŠ›ãƒ»ç”¨èªé›†CSVæ©Ÿèƒ½è¿½åŠ ï¼ˆå…¨ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼å¯¾å¿œï¼‰
- ç¿»è¨³å®Œäº†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°æ”¹å–„ï¼ˆå‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ãƒ»ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼‰

### 2.3 (2025-12)
- Copilot Freeå¯¾å¿œï¼ˆå‹•çš„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆåˆ‡ã‚Šæ›¿ãˆï¼‰
- ã‚³ãƒ¼ãƒ‰å“è³ªå‘ä¸Šï¼ˆä¾‹å¤–å‡¦ç†ã€ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ã€å®šæ•°åŒ–ï¼‰

### 2.2 (2025-12)
- å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«æ©Ÿèƒ½æ‹¡å¼µï¼ˆç”¨èªé›†â†’æ±ç”¨å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œï¼‰
- è¨­å®šé …ç›®è¿½åŠ 

### 2.1 (2025-11)
- è¨€èªè‡ªå‹•æ¤œå‡ºã€ç¿»è¨³å±¥æ­´ã€è‡ªå‹•æ›´æ–°ã€M3ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œ

### 2.0 (2024-11)
- å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã«åŸºã¥ãå®Œå…¨ãªä»•æ§˜æ›¸ä½œæˆ

---

> ã“ã®ä»•æ§˜æ›¸ã¯å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã‹ã‚‰è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚‚ã®ã§ã™ã€‚
> ã‚³ãƒ¼ãƒ‰ã¨ã®å·®ç•°ãŒã‚ã‚‹å ´åˆã¯ã€å®Ÿè£…ã‚³ãƒ¼ãƒ‰ãŒæ­£ã¨ãªã‚Šã¾ã™ã€‚
