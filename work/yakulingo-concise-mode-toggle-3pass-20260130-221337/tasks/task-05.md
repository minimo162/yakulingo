# task-05: テスト追加/更新（標準=1回、簡潔=3回、最終出力、ストリーミング合成）

見積: 30–60分

## ゴール
- intentに直結する挙動をテストで固定する。
  - 標準モード: 1回だけで最終出力が確定
  - 簡潔モード: 3回実行され、3回目が最終出力
  - ストリーミング合成（1回目維持 + 2回目 + 3回目）が壊れない
  - キャンセル時の戻り値/状態が一貫

## 変更範囲（ファイル）
- 触る:
  - `tests/test_*.py`（適切なモジュールに追加）
  - 必要に応じて`yakulingo/models/types.py`の型変更に追従

## 実装方針（推奨）
- backend（LocalAI）呼び出しはモックして回数/引数/順序を検証する。
- `on_chunk`はテキスト合成の入力として扱い、期待するプレビュー文字列をアサートする。

## 検証
- `uv run --extra test pyright`
- `uv run --extra test ruff check .`
- `uv run --extra test pytest`

## DoD（完了条件）
- 上記4点を最低限カバーするテストが追加されている
- typecheck/lint/testが全て通る
