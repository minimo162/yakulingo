# task-03: 動的用語集の改善（インライン用語集の取りこぼし防止）

## 目的
- 「動的用語集」がインライン用語集（CSVからのマッチ抽出）を指している場合に、数値系の重要語（例: `億円`）が **上限/選定ロジック** の都合で落ちないようにする。
- 必要であれば「数値ヒント（generated glossary）」の扱いを Copilot 側にも寄せる。

## 想定所要（タイムボックス）
- 15〜60分

## 変更対象（予定）
- `yakulingo/services/prompt_builder.py`
  - `_filter_glossary_pairs_for_inline()` の優先度設計（短いが重要な語の救済）
- （必要なら）`yakulingo/services/translation_service.py`
  - バッチプロンプトへの追加指示の挿入（サイズ上限込み）

## 検討ポイント
- 参照ファイルが多い/入力が長いと `max_lines=40` の競争で短語が落ちる可能性がある
- 数値単位系（`億円` 等）は短いが影響が大きいので、別枠で確保する価値がある

## 作業手順
1. 実データ（`glossary.csv`）と典型入力（ファイル翻訳のバッチ）で、`億円` が選ばれないケースがあるか確認
2. ある場合は、優先度計算に「数値単位系のブースト」または「必須語の別枠」を導入
3. テストを追加/更新して取りこぼしを防ぐ（短語が落ちないことを保証）

## DoD
- 動的用語集（インライン）に `億円` 等が必要時に含まれる（または同等の数値ヒントで補える）
- 変更は最小で、プロンプトサイズ上限を超えない
